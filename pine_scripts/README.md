# Pine Script V6 - 烛线形态策略

## 策略说明

这是一个基于烛线形态识别的TradingView交易策略脚本（Pine Script V6）。

### 核心逻辑

策略统计最近N根K线（默认5根）的形态，并根据以下规则生成交易信号：

#### 1. **K线形态分类**
- **收在最高**：收盘价 = 最高价
- **收在最低**：收盘价 = 最低价
- **十字星**：K线实体相对较小（实体/总高度比例小于阈值）

#### 2. **交易规则**

| 条件 | 操作 | 说明 |
|------|------|------|
| 十字星数量 ≥ 3个 | 不操作 | 形态混乱，跳过本轮交易 |
| 收最高 ≥ 2个 + 最后K线收最高 | **做多** | 顶部反复确认 |
| 收最低 ≥ 2个 + 最后K线收最低 | **做空** | 底部反复确认 |

### 参数配置

在TradingView中可调节的参数：

| 参数名 | 默认值 | 范围 | 说明 |
|-------|-------|------|------|
| K线统计数量 | 5 | 3-20 | 用于形态分析的K线根数 |
| 十字星阈值 | 0.1 | 0.0-1.0 | K线实体/总高度的比例限制，值越小越严格 |
| 十字星数量限制 | 3 | 1-10 | 触发跳过条件的十字星数量阈值 |

### 使用方法

1. **复制脚本**：
   - 打开 TradingView
   - 进入 "Pine Script Editor"
   - 创建新脚本
   - 复制此文件的全部内容

2. **添加到图表**：
   - 点击 "Add to Chart"
   - 调整参数以适应不同的交易品种和时间框架

3. **查看信号**：
   - 绿色向上箭头 ▲：买入信号
   - 红色向下箭头 ▼：卖出信号
   - 灰色十字 ⊠：跳过信号（十字星过多）

### 可视化输出

- **图表标记**：
  - 绿色标签：做多信号满足条件
  - 红色标签：做空信号满足条件
  - 灰色标签：跳过信号

- **统计表格**：
  - 实时显示最近N根K线的形态统计
  - 包括：收最高数量、收最低数量、十字星数量

### 止损/止盈设置

策略使用ATR（平均真实波幅）作为基础：
- **止损**：ATR × 2
- **止盈**：ATR × 3

可根据需要在代码中修改倍数。

### 注意事项

1. **回测验证**：使用前建议在历史数据上充分回测
2. **市场条件**：策略对不同的交易品种和时间框架效果差异较大
3. **风险管理**：建议设置合理的头寸大小和总体风险限制
4. **参数调整**：
   - 调大"十字星阈值"会识别更多十字星
   - 减少"K线统计数量"会使信号更频繁
   - 调整"十字星数量限制"影响跳过信号的敏感度

### 策略优化建议

- 可以添加移动平均线过滤（只在上升趋势做多）
- 可以添加波动率过滤（避免在低波动时交易）
- 可以分离多头和空头的参数
- 可以添加时间过滤（只在特定交易时段操作）

---

**最后更新**：2025年12月15日
